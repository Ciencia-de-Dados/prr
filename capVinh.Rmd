---
title: "Vinhetas"
author: "Fernando Mayer & Walmes Zeviani"
date: "61 RBRAS | 23 a 25 de Maio | Salvador/BA"
output:
  revealjs::revealjs_presentation:
    theme: serif
    highlight: haddock
    transition: fade
    css: _style_revealjs.css
    includes:
      in_header: _MathJax.html
---

<!--
theme:
solarized
simple
serif
default
beige
blood
moon
night
black
white
!league
!sky
-->

```{r, include=FALSE}
source("_setup.R")
opts_chunk$set(eval = FALSE)
# setwd("~/repos/MRDCr/"); devtools::load_all()
# setwd("~/repos/labestData/"); devtools::load_all()
# source("~/Dropbox/labestData/func.R")
```

## Por que Fazer Vinhetas?

  * Vinheta: episódio.
  * Utilizadas para ilustrar o uso coordenado de funções
  * Não tem restrição de tamanho
  * Um pacote pode ter várias
  * Vinhetas são as melhor forma de divulgar o pacote
  * Permitem tabelas, gráficos, equações e referências

---

A partir da versão 3.? do R

  * Vinhetas não Sweave foram permitidas
  * Rmd
  * Rnw knitr

---

As vinhetas podem ser

  * Artigos completos em PDF, com texto, equações, tabelas, gráficos e
    referências.
  * Usadas como páginas HTML disponíveis na web como tutoriais, material
    de ensino ou matérias de blog.
  * Material de Curso contidas em um pacote com dados e funções
    disponibilizado aos participantes.
  * O TCC/Dissertação/Tese e o pacote disponibilizado o produto final.

## Consultando as Vinhetas Disponíveis

```{r}
# Abre no navegador.
browseVignettes()

# Exibe no console.
vignette()

# Filtra por pacote.
browseVignettes(package = "devtools")
vignette(package = "devtools")

# Abre a vinheta.
vignette(topic = "dependencies", package = "devtools")
```

## Construindo a Estrutura para Vinhetas

Na raíz do diretório do pacote
```{r}
library(devtools)

use_vignette(name = "AnaExpDIC")
```

Cria de diretório e arquivos
```
* Creating `vignettes`.
* Adding `inst/doc` to ./.gitignore
```
```
.
`-- vignettes/
    `-- AnaExpDIC.Rmd
```

Acrescenta automaticamente ao `DESCRIPTION`
```
Suggests: knitr,
    rmarkdown
VignetteBuilder: knitr
```

## Vinheta em RMarkDown para documento HTML

Criado por padrão pela `use_vignettes()`
```
---
title: "Vignette Title"
author: "Vignette Author"
date: "``r paste("r Sys.Date()")``"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```

`rmarkdown::html_document` pode ser usado também, além de outros.

## Vinheta em RMarkDown para documento PDF

Use `rmarkdown::pdf_document`
```
---
title: "Vignette Title"
author: "Vignette Author"
date: "``r paste("r Sys.Date()")``"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```

## Vinheta em Rnw-knitr para documento PDF

Crie um documento Rnw com os metadados no topo
```
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Vignette Title}
%\VignetteEncoding{UTF-8}

\documentclass{article}

... Preambulo ...

\begin{document}

... Corpo do texto ...

\end{document}
```

Use *chunk headers* do knitr.

---

Estrutura resumida dos tipos de Vinheta
```
Rmd -> HTML | PDF
|-- output:
|   |-- rmarkdown::html_vignette
|   |-- rmarkdown::html_document
|   `-- rmarkdown::pdf_document
|-- vignette: >
|     %\VignetteIndexEntry{Vignette Title}
|     %\VignetteEngine{knitr::rmarkdown}
|     %\VignetteEncoding{UTF-8}
`-- DESCRIPTION
      Suggests: knitr,
          rmarkdown
      VignetteBuilder: knitr

Rnw -> PDF
|-- vignette: >
|     %\VignetteIndexEntry{Vignette Title}
|     %\VignetteEngine{knitr::knitr}
|     %\VignetteEncoding{UTF-8}
`-- DESCRIPTION
      Suggests: knitr,
      VignetteBuilder: knitr
```

## Construindo as Vinhetas

Gera o documento final e move arquivos
```{r}
# Gera e move todas as vinhetas em vignettes/.
# build_vignettes(dependencies = FALSE)
build_vignettes()
```
```
Building labestData vignettes
Moving AnaExpDIC.pdf, anaExpDBC.pdf, AnaExpDIC.R,
anaExpDBC.R to inst/doc/
Copying AnaExpDIC.Rmd, anaExpDBC.Rnw to inst/doc/
```

Verifica o pacote e o código da vinheta
```{r}
check()
```
```
... omitido ...
* checking installed files from ‘inst/doc’ ... OK
* checking files in ‘vignettes’ ... OK
* checking examples ... OK
* checking for unstated dependencies in vignettes ... OK
* checking package vignettes in ‘inst/doc’ ... OK
* checking re-building of vignette outputs ... OK
* DONE
```

## Gerando as Vinhetas Individualmente

  1. Útil quando a vinheta está sendo desenvolvida

<br>

```{r}
rmarkdown::render("vignettes/AnaExpDIC.Rmd")
```
```
./vignettes
|-- AnaExpDIC.html
`-- AnaExpDIC.Rmd
```

Na `vignettes/` ficam os fontes e arquivos auxiliares, na `inst/doc`
apenas os *outputs* finais.

## MarkDown

Existe bastante recurso no MarkDown-Pandoc.

```
title: Minha Vinheta
author: Joselito
graphics: yes
output:
  pdf_document:
    highlight: default
    template: template.tex
    keep_tex: true
  html_document:
    highlight: default
    css: _style.css
    includes:
      in_header: _MathJax.html
      before_body: _before_body.html
      after_body: _after_body.html
bibliography: refs.bib
csl: ABNT_UFPR_2011-Mendeley.csl
```

Visite <http://rmarkdown.rstudio.com/index.html>.

## Pacotes para Consulta

  - [`MRDCr`] - *Modelos de Regressão para Dados de Contagem com o R*,
    Walmes Zeviani, Eduardo Jr e Cesar Taconeli (LEG/UFPR).
    [`labestData`] - *Conjuntos de Dados para Ensino de Estatística*,
    PET Estatística UFPR.
  - [`mcglm`] - *Multivariate Covariance Generalized Linear Models*,
    Wagner Hugo Bonat e colaboradores (LEG/UFPR).
  - [`breedR`] - *Statistical Methods for Forest Genetic Resources
    analysts*, Facundo Muñoz.
  - [`bbmle`] - *Tools for General Maximum Likelihood Estimation*,
    Ben Bolker.
  - [`knitr`] - *Elegant, flexible and fast dynamic report generation
    with R*, [Yihui Xie].

## Considerações Finais

  * As vinhetas são a representação mais fiel de Pesquisa Reproduzível
    com o R.
  * Os pacotes `devtools` tem recursos que facilitam a criação e
    manutenção de vinhetas no pacote.
  * O `knitr` junto com o PanDoc facilitam a elaboração de vinhetas em
    RMarkDown.
  * Vinhetas em PDF também são permitidas...
  * Vinhetas em HTML ...

## Além disso

  * Use um Sistema de Controle de Versão (e.g. Git).
  * Disponibilize seu código (e.g. GitHub ou GitLab).
  * Disponibilize suas vinhetas como `gh-pages`.

<!------------------------------------------- -->

[`MRDCr`]: https://github.com/leg/MRDCr/
[`labestData`]: https://github.com/pet-estatistica/labestData
[`mcglm`]: https://github.com/wbonat/mcglm/
[`breedR`]: https://github.com/famuvie/breedR/
[`bbmle`]: https://github.com/cran/bbmle/
[Yihui Xie]: yihui.name/knitr/demo/vignette/
[`knitr`]: https://github.com/yihui/knitr
